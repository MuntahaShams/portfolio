---
import projects from "../data/projects.json";

const filters = ["All", "CV", "ML", "NLP", "GenAI"];

const selected = Astro.url.searchParams.get("filter") ?? "All";

const filtered =
  selected === "All"
    ? projects
    : projects.filter((p) => p.category?.includes(selected));
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Projects</title>
    <style>
      body { font-family: system-ui; padding: 24px; max-width: 1100px; margin: 0 auto; }
      .row { display: flex; gap: 10px; flex-wrap: wrap; margin: 16px 0 24px; }
      .btn { padding: 8px 12px; border: 1px solid #444; border-radius: 999px; text-decoration: none; color: inherit; }
      .btn.active { background: #444; color: white; }
      .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 16px; }
      .card { border: 1px solid #333; border-radius: 14px; overflow: hidden; text-decoration: none; color: inherit; }
      .card img { width: 100%; height: 160px; object-fit: cover; display: block; }
      .card .p { padding: 12px; }
      .tag { display: inline-block; font-size: 12px; opacity: 0.8; margin-right: 6px; }
      .title { font-weight: 700; margin: 6px 0 6px; }
      .desc { opacity: 0.9; font-size: 14px; line-height: 1.35; }
    </style>
  </head>

  <body>
    <h1>Projects</h1>
    <p>{projects.length} projects â€¢ Filter: <b>{selected}</b></p>

    <nav class="row">
      {filters.map((f) => (
        <a
          class={`btn ${f === selected ? "active" : ""}`}
          href={`${import.meta.env.BASE_URL}projects${f === "All" ? "" : `?filter=${encodeURIComponent(f)}`}`}
        >
          {f}
        </a>
      ))}
    </nav>

    <section class="grid">
      {filtered.map((p) => (
        <a class="card" href={`${import.meta.env.BASE_URL}projects/${p.slug}`}>
          <img src={p.media?.cover ?? "/media/cover.png"} alt={p.title} />
          <div class="p">
            <div>
              {(p.category ?? []).map((c) => (
                <span class="tag">#{c}</span>
              ))}
            </div>
            <div class="title">{p.title}</div>
            <div class="desc">{p.one_liner}</div>
          </div>
        </a>
      ))}
    </section>
  </body>
</html>
