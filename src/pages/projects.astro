---
import projects from "../data/projects.json";

/** Ensure BASE_URL always ends with a trailing slash */
const baseRaw = import.meta.env.BASE_URL || "/";
const base = baseRaw.endsWith("/") ? baseRaw : `${baseRaw}/`;

const filters = ["All", "CV", "ML", "NLP", "GenAI"];
const selected = Astro.url.searchParams.get("filter") ?? "All";

const filtered =
  selected === "All"
    ? projects
    : projects.filter((p) => (p.category ?? []).includes(selected));
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Projects</title>
    <style>
      body { font-family: system-ui; padding: 24px; max-width: 1100px; margin: 0 auto; }
      .row { display: flex; gap: 10px; flex-wrap: wrap; margin: 16px 0 24px; }
      .btn { padding: 8px 12px; border: 1px solid #444; border-radius: 999px; text-decoration: none; color: inherit; }
      .btn.active { background: #444; color: white; }

      .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 16px; }
      .card { border: 1px solid #333; border-radius: 14px; overflow: hidden; text-decoration: none; color: inherit; }
      .p { padding: 12px; }

      .tag { display: inline-block; font-size: 12px; opacity: 0.8; margin-right: 6px; }
      .title { font-weight: 700; margin: 6px 0 6px; line-height: 1.2; }
      .desc { opacity: 0.9; font-size: 14px; line-height: 1.35; }

      /* Cover image BELOW title and NOT cropped */
      .thumb {
        width: 100%;
        height: 180px;        /* adjust if you want */
        object-fit: contain;  /* show full image */
        background: #111;     /* letterbox background */
        border-radius: 12px;
        border: 1px solid #333;
        margin-top: 10px;
        display: block;
      }

      @media (prefers-color-scheme: dark) {
        body { background:#0b0b0f; color:#f2f2f2; }
        .btn { border-color:#666; }
        .btn.active { background:#f2f2f2; color:#0b0b0f; }
        .card { border-color:#444; }
        .thumb { border-color:#444; }
      }
    </style>
  </head>

  <body>
    <p style="max-width: 820px; line-height: 1.5; opacity: 0.9;">
      Hi, I’m <b>Muntaha Shams</b> — I build AI products across <b>GenAI (RAG/LLMs)</b>, <b>Computer Vision</b>,
      and <b>ML systems</b>, with production-focused APIs and UI demos.
    </p>

    <p style="display:flex; gap:14px; flex-wrap:wrap; margin: 8px 0 18px;">
      <a href="mailto:muntahashams288@gmail.com" style="text-decoration:none; border:1px solid #444; padding:8px 12px; border-radius:999px;">Email</a>
      <a href="https://github.com/MuntahaShams" target="_blank" rel="noreferrer" style="text-decoration:none; border:1px solid #444; padding:8px 12px; border-radius:999px;">GitHub</a>
    </p>

    <h1>Projects</h1>
    <p>{projects.length} projects • Filter: <b>{selected}</b></p>

    <nav class="row">
      {filters.map((f) => {
        const href =
          f === "All"
            ? `${base}projects`
            : `${base}projects?filter=${encodeURIComponent(f)}`;

        return (
          <a class={`btn ${f === selected ? "active" : ""}`} href={href}>
            {f}
          </a>
        );
      })}
    </nav>

    <section class="grid">
      {filtered.map((p) => {
        const imgSrc = `${base}${p.media.cover}`;     // /portfolio/media/...
        const href = `${base}projects/${p.slug}`;     // /portfolio/projects/<slug>

        return (
          <a class="card" href={href}>
            <div class="p">
              <div>
                {(p.category ?? []).map((c) => (
                  <span class="tag">#{c}</span>
                ))}
              </div>

              <div class="title">{p.title}</div>
              <div class="desc">{p.one_liner}</div>

              <img class="thumb" src={imgSrc} alt={p.title} loading="lazy" />
            </div>
          </a>
        );
      })}
    </section>
  </body>
</html>
